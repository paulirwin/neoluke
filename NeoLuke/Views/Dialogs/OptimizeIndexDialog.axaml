<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:NeoLuke.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="600"
        x:Class="NeoLuke.Views.Dialogs.OptimizeIndexDialog"
        x:DataType="vm:OptimizeIndexDialogViewModel"
        Title="Optimize Index"
        Width="600" Height="600"
        WindowStartupLocation="CenterOwner"
        CanResize="True">

    <Design.DataContext>
        <vm:OptimizeIndexDialogViewModel/>
    </Design.DataContext>

    <DockPanel Margin="20">
        <!-- Header Section -->
        <StackPanel DockPanel.Dock="Top" Spacing="10" Margin="0,0,0,20">
            <!-- Index Path -->
            <StackPanel Orientation="Horizontal" Spacing="5">
                <TextBlock Text="Index Path:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding IndexPath}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
            </StackPanel>

            <!-- Expunge Deletes Checkbox -->
            <CheckBox IsChecked="{Binding ExpungeDeletes}"
                      IsEnabled="{Binding !IsOptimizing}">
                <TextBlock Text="Expunge deletes only (removes deleted documents)"
                          TextWrapping="Wrap"/>
            </CheckBox>

            <!-- Max Segments -->
            <StackPanel Orientation="Horizontal" Spacing="10" IsEnabled="{Binding !ExpungeDeletes}">
                <TextBlock Text="Maximum number of segments:" VerticalAlignment="Center"/>
                <NumericUpDown Value="{Binding MaxSegments}"
                              Minimum="1"
                              Maximum="100"
                              Width="100"
                              IsEnabled="{Binding !IsOptimizing}"/>
            </StackPanel>

            <!-- Buttons -->
            <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Right" Margin="0,10,0,0">
                <Button Content="Optimize"
                        Command="{Binding OptimizeCommand}"
                        IsEnabled="{Binding !IsOptimizing}"
                        Width="100"/>
                <Button Name="CloseButton"
                        Content="Close"
                        Width="100"/>
            </StackPanel>
        </StackPanel>

        <!-- Note Section -->
        <Border DockPanel.Dock="Top"
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                Padding="10"
                Margin="0,0,0,10"
                CornerRadius="5">
            <StackPanel Spacing="5">
                <TextBlock Text="Note:" FontWeight="Bold"/>
                <TextBlock TextWrapping="Wrap">
                    Optimizing an index can take a long time and requires substantial disk space.
                    The index will be unavailable during optimization.
                </TextBlock>
            </StackPanel>
        </Border>

        <!-- Status Section -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Spacing="10" Margin="0,0,0,10">
            <TextBlock Text="Status:" FontWeight="SemiBold" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding StatusText}" VerticalAlignment="Center"/>
            <ProgressBar IsIndeterminate="True"
                        Width="100"
                        Height="20"
                        IsVisible="{Binding IsOptimizing}"/>
        </StackPanel>

        <!-- Log Output -->
        <Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                BorderThickness="1"
                CornerRadius="5"
                Padding="5">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <TextBox Text="{Binding LogText}"
                        IsReadOnly="True"
                        AcceptsReturn="True"
                        TextWrapping="Wrap"
                        BorderThickness="0"
                        Background="Transparent"
                        FontFamily="Consolas,Menlo,Monaco,Courier New,monospace"
                        FontSize="12"/>
            </ScrollViewer>
        </Border>
    </DockPanel>
</Window>
