<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:vm="using:NeoLuke.ViewModels"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        mc:Ignorable="d" d:DesignWidth="600" d:DesignHeight="600"
        x:Class="NeoLuke.Views.Dialogs.CheckIndexDialog"
        x:DataType="vm:CheckIndexDialogViewModel"
        Title="Check Index"
        Width="600" Height="600"
        WindowStartupLocation="CenterOwner"
        CanResize="True">

    <Design.DataContext>
        <vm:CheckIndexDialogViewModel/>
    </Design.DataContext>

    <DockPanel Margin="20">
        <!-- Header Section -->
        <StackPanel DockPanel.Dock="Top" Spacing="10" Margin="0,0,0,20">
            <!-- Index Path -->
            <StackPanel Orientation="Horizontal" Spacing="5">
                <TextBlock Text="Index Path:" FontWeight="SemiBold" VerticalAlignment="Center"/>
                <TextBlock Text="{Binding IndexPath}" VerticalAlignment="Center" TextTrimming="CharacterEllipsis"/>
            </StackPanel>

            <!-- Result -->
            <Border Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                    Padding="10"
                    CornerRadius="5">
                <StackPanel Spacing="5">
                    <TextBlock Text="Results:" FontWeight="Bold"/>
                    <TextBlock Text="{Binding ResultText}" TextWrapping="Wrap"/>
                </StackPanel>
            </Border>

            <!-- Buttons -->
            <StackPanel Orientation="Horizontal" Spacing="10" HorizontalAlignment="Right" Margin="0,10,0,0">
                <Button Content="Check Index"
                        Command="{Binding CheckIndexCommand}"
                        IsEnabled="{Binding !IsChecking}"
                        Width="120"/>
                <Button Name="CloseButton"
                        Content="Close"
                        Width="100"/>
            </StackPanel>
        </StackPanel>

        <!-- Repair Section -->
        <Border DockPanel.Dock="Top"
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                Padding="10"
                Margin="0,0,0,10"
                CornerRadius="5"
                IsVisible="{Binding CanRepair}">
            <StackPanel Spacing="10">
                <StackPanel Orientation="Horizontal" Spacing="10">
                    <Button Content="Repair Index"
                            Command="{Binding RepairIndexCommand}"
                            IsEnabled="{Binding !IsRepairing}"/>
                    <TextBlock Text="⚠️ WARNING: Repairing will remove bad segments and may result in document loss!"
                              TextWrapping="Wrap"
                              Foreground="Red"
                              VerticalAlignment="Center"
                              FontWeight="SemiBold"/>
                </StackPanel>
            </StackPanel>
        </Border>

        <!-- Status Section -->
        <StackPanel DockPanel.Dock="Top" Orientation="Horizontal" Spacing="10" Margin="0,0,0,10">
            <TextBlock Text="Status:" FontWeight="SemiBold" VerticalAlignment="Center"/>
            <TextBlock Text="{Binding StatusText}" VerticalAlignment="Center"/>
            <ProgressBar IsIndeterminate="True"
                        Width="100"
                        Height="20"
                        IsVisible="{Binding IsChecking}"/>
            <ProgressBar IsIndeterminate="True"
                        Width="100"
                        Height="20"
                        IsVisible="{Binding IsRepairing}"/>
        </StackPanel>

        <!-- Note Section -->
        <Border DockPanel.Dock="Top"
                Background="{DynamicResource SystemControlBackgroundAltHighBrush}"
                Padding="10"
                Margin="0,0,0,10"
                CornerRadius="5">
            <StackPanel Spacing="5">
                <TextBlock Text="Note:" FontWeight="Bold"/>
                <TextBlock TextWrapping="Wrap">
                    Checking the index may take some time depending on the index size.
                    The check process is read-only and will not modify the index.
                </TextBlock>
            </StackPanel>
        </Border>

        <!-- Log Output -->
        <Border BorderBrush="{DynamicResource SystemControlForegroundBaseMediumBrush}"
                BorderThickness="1"
                CornerRadius="5"
                Padding="5">
            <ScrollViewer VerticalScrollBarVisibility="Auto">
                <TextBox Text="{Binding LogText}"
                        IsReadOnly="True"
                        AcceptsReturn="True"
                        TextWrapping="Wrap"
                        BorderThickness="0"
                        Background="Transparent"
                        FontFamily="Consolas,Menlo,Monaco,Courier New,monospace"
                        FontSize="12"/>
            </ScrollViewer>
        </Border>
    </DockPanel>
</Window>
